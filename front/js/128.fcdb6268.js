"use strict";(self["webpackChunkfornt"]=self["webpackChunkfornt"]||[]).push([[128],{128:function(e,a,t){t.r(a),t.d(a,{default:function(){return A}});var o=t(6768),l=t(5130),n=t(4232);const s={class:"page-container"},i={style:{display:"flex","align-items":"center"}},r={style:{margin:"16px"}},c={class:"category-picker"};function d(e,a,t,d,u,g){const p=(0,o.g2)("van-nav-bar"),m=(0,o.g2)("van-field"),y=(0,o.g2)("van-cell"),f=(0,o.g2)("van-icon"),v=(0,o.g2)("van-cell-group"),b=(0,o.g2)("van-button"),k=(0,o.g2)("van-uploader"),C=(0,o.g2)("van-form"),h=(0,o.g2)("van-dialog");return(0,o.uX)(),(0,o.CE)("div",s,[(0,o.bF)(p,{title:"上传试卷","left-text":"返回","left-arrow":"",onClickLeft:d.goBack},null,8,["onClickLeft"]),(0,o.bF)(C,{onSubmit:d.onSubmit},{default:(0,o.k6)(()=>[(0,o.bF)(v,{inset:""},{default:(0,o.k6)(()=>[(0,o.bF)(m,{modelValue:d.formData.name,"onUpdate:modelValue":a[0]||(a[0]=e=>d.formData.name=e),name:"name",label:"试卷名称",placeholder:"请输入试卷名称",rules:[{required:!0,message:"请输入试卷名称"}]},null,8,["modelValue"]),(0,o.bF)(m,{modelValue:d.formData.categoryId,"onUpdate:modelValue":a[2]||(a[2]=e=>d.formData.categoryId=e),name:"categoryId",label:"所属分类",rules:[{required:!0,message:"请选择所属分类"}]},{input:(0,o.k6)(()=>[(0,o.bF)(v,{inset:"",style:{margin:"0",padding:"0"}},{default:(0,o.k6)(()=>[(0,o.Lk)("div",i,[(0,o.bF)(y,{title:d.selectedCategory?d.selectedCategory.name:"请选择分类","is-link":"",onClick:a[1]||(a[1]=e=>d.showCategoryPicker=!0)},null,8,["title"]),(0,o.bF)(f,{name:"plus",size:"20",onClick:(0,l.D$)(d.openAddDialog,["stop"]),style:{"margin-left":"8px",cursor:"pointer"}},null,8,["onClick"])])]),_:1})]),_:1},8,["modelValue"]),(0,o.bF)(m,{name:"file",label:"试卷文件"},{input:(0,o.k6)(()=>[(0,o.bF)(k,{modelValue:d.fileList,"onUpdate:modelValue":a[3]||(a[3]=e=>d.fileList=e),"max-count":1,"before-read":d.beforeRead,onDelete:d.onFileDelete,accept:".pdf,application/pdf"},{default:(0,o.k6)(()=>[(0,o.bF)(b,{icon:"plus",type:"primary"},{default:(0,o.k6)(()=>a[8]||(a[8]=[(0,o.eW)("上传文件")])),_:1,__:[8]})]),_:1},8,["modelValue","before-read","onDelete"])]),_:1})]),_:1}),(0,o.Lk)("div",r,[(0,o.bF)(b,{round:"",block:"",type:"primary","native-type":"submit",disabled:d.uploading},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(d.uploading?"上传中...":"提交"),1)]),_:1},8,["disabled"])])]),_:1},8,["onSubmit"]),(0,o.bF)(h,{show:d.showCategoryPicker,"onUpdate:show":a[4]||(a[4]=e=>d.showCategoryPicker=e),title:"选择分类","show-cancel-button":"",onConfirm:a[5]||(a[5]=e=>d.showCategoryPicker=!1)},{default:(0,o.k6)(()=>[(0,o.Lk)("div",c,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(d.categories,e=>((0,o.uX)(),(0,o.Wv)(y,{key:e.id,title:e.name,clickable:"",onClick:a=>d.selectCategory(e)},{"right-icon":(0,o.k6)(()=>[d.selectedCategory&&d.selectedCategory.id===e.id?((0,o.uX)(),(0,o.Wv)(f,{key:0,name:"success",color:"#1989fa"})):(0,o.Q3)("",!0)]),_:2},1032,["title","onClick"]))),128))])]),_:1},8,["show"]),(0,o.bF)(h,{show:d.showAddCategoryDialog,"onUpdate:show":a[7]||(a[7]=e=>d.showAddCategoryDialog=e),title:"添加分类","show-cancel-button":"",onConfirm:d.addCategory},{default:(0,o.k6)(()=>[(0,o.bF)(m,{modelValue:d.newCategoryName,"onUpdate:modelValue":a[6]||(a[6]=e=>d.newCategoryName=e),label:"分类名称",placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1},8,["show","onConfirm"])])}t(4114);var u=t(144),g=t(1387),p=(t(8111),t(2489),t(7588),t(8442)),m=t(4473),y=t(6596);const f={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let v=[],b=!1,k=(0,p.X$)({},f);const C=new Map;function h(e){return(0,p.Gv)(e)?e:{message:e}}function w(){const{instance:e,unmount:a}=(0,m.b)({setup(){const t=(0,u.KR)(""),{open:l,state:n,close:s,toggle:i}=(0,m.T)(),r=()=>{b&&(v=v.filter(a=>a!==e),a())},c=()=>{const e={onClosed:r,"onUpdate:show":i};return(0,o.bF)(y.A,(0,o.v6)(n,e),null)};return(0,o.wB)(t,e=>{n.message=e}),(0,o.nI)().render=c,{open:l,close:s,message:t}}});return e}function F(){if(!v.length||b){const e=w();v.push(e)}return v[v.length-1]}function D(e={}){if(!p.M)return{};const a=F(),t=h(e);return a.open((0,p.X$)({},k,C.get(t.type||k.type),t)),a}const _=e=>a=>D((0,p.X$)({type:e},h(a)));_("loading"),_("success"),_("fail");var V=t(5092),I={name:"UploadPage",setup(){const e=(0,g.rd)(),a=(0,u.KR)([]),t=(0,u.KR)([]),l=(0,u.KR)(null),n=(0,u.KR)(!1),s=(0,u.KR)(!1),i=(0,u.KR)(""),r=(0,u.KR)(!1),c=(0,u.Kh)({name:"",categoryId:null}),d=async()=>{try{const e=await(0,V.rm)();t.value=e.data.data||[]}catch(e){console.error("获取分类列表失败:",e),D({type:"fail",message:"获取分类列表失败"})}},p=e=>{l.value=e,c.categoryId=e.id,n.value=!1},m=e=>{const a="application/pdf"===e.type;return!!a||(D({type:"fail",message:"请上传 PDF 格式的文件"}),!1)},y=()=>{a.value=[]},f=async()=>{if(l.value)if(0!==a.value.length)try{r.value=!0;const t=new FormData;t.append("file",a.value[0].file),t.append("name",c.name),t.append("categoryId",c.categoryId);const o=await(0,V.MU)(t);200===o.data.code?(D({type:"success",message:"上传成功"}),e.push("/")):D({type:"fail",message:"上传失败"})}catch(t){console.error("上传试卷失败:",t),D({type:"fail",message:"上传试卷失败"})}finally{r.value=!1}else D({type:"fail",message:"请上传试卷文件"});else D({type:"fail",message:"请选择所属分类"})},v=()=>{e.back()};(0,o.sV)(()=>{d()});const b=async()=>{if(i.value)try{const e=await(0,V.Ah)({name:i.value});200===e.data.code?(D({type:"success",message:"添加分类成功"}),d(),i.value="",s.value=!1):D({type:"fail",message:e.data.msg||"添加分类失败"})}catch(e){console.error("添加分类失败:",e),D({type:"fail",message:"添加分类失败"})}else D({type:"fail",message:"请输入分类名称"})},k=()=>{console.log("Add category button clicked"),s.value=!0};return{formData:c,fileList:a,categories:t,selectedCategory:l,showCategoryPicker:n,showAddCategoryDialog:s,newCategoryName:i,uploading:r,beforeRead:m,onFileDelete:y,onSubmit:f,selectCategory:p,addCategory:b,goBack:v,openAddDialog:k}}},K=t(1241);const R=(0,K.A)(I,[["render",d],["__scopeId","data-v-77538736"]]);var A=R}}]);
//# sourceMappingURL=128.fcdb6268.js.map