"use strict";(self["webpackChunkfornt"]=self["webpackChunkfornt"]||[]).push([[598],{2598:function(e,o,t){t.r(o),t.d(o,{default:function(){return F}});var l=t(6768);const a={class:"upload-question"},r={class:"category-selector"},i={class:"options-container"},s={class:"dialog-footer"};function n(e,o,t,n,d,u){const m=(0,l.g2)("van-nav-bar"),c=(0,l.g2)("el-input"),g=(0,l.g2)("el-form-item"),p=(0,l.g2)("el-option"),F=(0,l.g2)("el-select"),h=(0,l.g2)("CirclePlus"),y=(0,l.g2)("el-icon"),b=(0,l.g2)("el-button"),f=(0,l.g2)("el-radio"),C=(0,l.g2)("el-radio-group"),k=(0,l.g2)("el-form"),q=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",a,[(0,l.bF)(m,{title:"上传题目","left-text":"返回","left-arrow":"",onClickLeft:u.goBack},null,8,["onClickLeft"]),(0,l.bF)(k,{model:d.questionForm,rules:d.rules,ref:"questionFormRef","label-width":"120px",class:"question-form"},{default:(0,l.k6)(()=>[(0,l.bF)(g,{label:"题目内容",prop:"content"},{default:(0,l.k6)(()=>[(0,l.bF)(c,{modelValue:d.questionForm.content,"onUpdate:modelValue":o[0]||(o[0]=e=>d.questionForm.content=e),type:"textarea",rows:4,placeholder:"请输入题目内容"},null,8,["modelValue"])]),_:1}),(0,l.bF)(g,{label:"题目分类",prop:"categoryId",class:"category"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",r,[(0,l.bF)(F,{modelValue:d.questionForm.categoryId,"onUpdate:modelValue":o[1]||(o[1]=e=>d.questionForm.categoryId=e),placeholder:"请选择分类",class:"category-select"},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(d.categories,e=>((0,l.uX)(),(0,l.Wv)(p,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(0,l.bF)(b,{type:"primary",onClick:u.showAddCategoryDialog},{default:(0,l.k6)(()=>[(0,l.bF)(y,null,{default:(0,l.k6)(()=>[(0,l.bF)(h)]),_:1})]),_:1},8,["onClick"])])]),_:1}),(0,l.bF)(g,{label:"题目类型",prop:"type"},{default:(0,l.k6)(()=>[(0,l.bF)(F,{modelValue:d.questionForm.type,"onUpdate:modelValue":o[2]||(o[2]=e=>d.questionForm.type=e),placeholder:"请选择题目类型"},{default:(0,l.k6)(()=>[(0,l.bF)(p,{label:"单选题",value:"CHOICE"}),(0,l.bF)(p,{label:"判断题",value:"TRUE_FALSE"}),(0,l.bF)(p,{label:"填空题",value:"FILL_IN"}),(0,l.bF)(p,{label:"简答题",value:"ESSAY"})]),_:1},8,["modelValue"])]),_:1}),"CHOICE"===d.questionForm.type?((0,l.uX)(),(0,l.Wv)(g,{key:0,label:"选项列表",prop:"options"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",i,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(d.questionForm.options,(e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"option-item"},[(0,l.bF)(c,{modelValue:d.questionForm.options[t],"onUpdate:modelValue":e=>d.questionForm.options[t]=e,placeholder:`选项 ${String.fromCharCode(65+t)}`,class:"option-input"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),(0,l.bF)(b,{type:"danger",size:"small",onClick:e=>u.removeOption(t),disabled:d.questionForm.options.length<=2},{default:(0,l.k6)(()=>o[8]||(o[8]=[(0,l.eW)(" 删除 ")])),_:2,__:[8]},1032,["onClick","disabled"])]))),128)),(0,l.bF)(b,{type:"primary",size:"small",onClick:u.addOption},{default:(0,l.k6)(()=>o[9]||(o[9]=[(0,l.eW)(" 添加选项 ")])),_:1,__:[9]},8,["onClick"])])]),_:1})):(0,l.Q3)("",!0),(0,l.bF)(g,{label:"答案",prop:"answer"},{default:(0,l.k6)(()=>["CHOICE"===d.questionForm.type?((0,l.uX)(),(0,l.Wv)(F,{key:0,modelValue:d.questionForm.answer,"onUpdate:modelValue":o[3]||(o[3]=e=>d.questionForm.answer=e),placeholder:"请选择正确答案"},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(d.questionForm.options,(e,o)=>((0,l.uX)(),(0,l.Wv)(p,{key:o,label:`${String.fromCharCode(65+o)}. ${e}`,value:String.fromCharCode(65+o)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):"TRUE_FALSE"===d.questionForm.type?((0,l.uX)(),(0,l.Wv)(C,{key:1,modelValue:d.questionForm.answer,"onUpdate:modelValue":o[4]||(o[4]=e=>d.questionForm.answer=e)},{default:(0,l.k6)(()=>[(0,l.bF)(f,{label:"正确"},{default:(0,l.k6)(()=>o[10]||(o[10]=[(0,l.eW)("正确")])),_:1,__:[10]}),(0,l.bF)(f,{label:"错误"},{default:(0,l.k6)(()=>o[11]||(o[11]=[(0,l.eW)("错误")])),_:1,__:[11]})]),_:1},8,["modelValue"])):((0,l.uX)(),(0,l.Wv)(c,{key:2,modelValue:d.questionForm.answer,"onUpdate:modelValue":o[5]||(o[5]=e=>d.questionForm.answer=e),type:"textarea",rows:3,placeholder:"请输入答案"},null,8,["modelValue"]))]),_:1}),(0,l.bF)(g,null,{default:(0,l.k6)(()=>[(0,l.bF)(b,{type:"primary",onClick:u.submitForm,loading:d.loading},{default:(0,l.k6)(()=>o[12]||(o[12]=[(0,l.eW)(" 上传题目 ")])),_:1,__:[12]},8,["onClick","loading"]),(0,l.bF)(b,{onClick:u.resetForm},{default:(0,l.k6)(()=>o[13]||(o[13]=[(0,l.eW)("重置")])),_:1,__:[13]},8,["onClick"])]),_:1})]),_:1},8,["model","rules"]),(0,l.bF)(q,{modelValue:d.addCategoryDialogVisible,"onUpdate:modelValue":o[7]||(o[7]=e=>d.addCategoryDialogVisible=e),title:"添加分类",width:"400px","before-close":u.handleCloseAddDialog},{footer:(0,l.k6)(()=>[(0,l.Lk)("span",s,[(0,l.bF)(b,{onClick:u.handleCloseAddDialog},{default:(0,l.k6)(()=>o[14]||(o[14]=[(0,l.eW)("取消")])),_:1,__:[14]},8,["onClick"]),(0,l.bF)(b,{type:"primary",onClick:u.submitAddCategory,loading:d.addCategoryLoading},{default:(0,l.k6)(()=>o[15]||(o[15]=[(0,l.eW)(" 确定 ")])),_:1,__:[15]},8,["onClick","loading"])])]),default:(0,l.k6)(()=>[(0,l.bF)(k,{model:d.categoryForm,rules:d.categoryRules,ref:"categoryFormRef","label-width":"80px"},{default:(0,l.k6)(()=>[(0,l.bF)(g,{label:"分类名称",prop:"name"},{default:(0,l.k6)(()=>[(0,l.bF)(c,{modelValue:d.categoryForm.name,"onUpdate:modelValue":o[6]||(o[6]=e=>d.categoryForm.name=e),placeholder:"请输入分类名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","before-close"])]),(0,l.bF)(b,{id:"upload-btn",type:"success",onClick:u.goToUpload,size:"large",round:""},{default:(0,l.k6)(()=>o[16]||(o[16]=[(0,l.eW)("上传试卷")])),_:1,__:[16]},8,["onClick"])],64)}t(4114),t(8111),t(2489),t(116),t(3579);var d=t(5092),u=t(1219),m=t(7477),c={name:"UploadQuestion",components:{CirclePlus:m.CirclePlus},data(){return{loading:!1,addCategoryLoading:!1,addCategoryDialogVisible:!1,categories:[],multipleAnswers:[],questionForm:{content:"",categoryId:null,options:["",""],type:"",answer:""},categoryForm:{name:""},rules:{content:[{required:!0,message:"请输入题目内容",trigger:"blur"}],categoryId:[{required:!0,message:"请选择题目分类",trigger:"change"}],type:[{required:!0,message:"请选择题目类型",trigger:"change"}],options:[{validator:(e,o,t)=>{"CHOICE"===this.questionForm.type?!o||o.length<2?t(new Error("至少需要2个选项")):o.some(e=>!e.trim())?t(new Error("选项内容不能为空")):t():t()},trigger:"blur"}],answer:[{required:!0,message:"请输入或选择答案",trigger:"blur"}]},categoryRules:{name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{min:1,max:50,message:"分类名称长度在 1 到 50 个字符",trigger:"blur"}]}}},watch:{"questionForm.type"(e){"CHOICE"===e?0===this.questionForm.options.length&&(this.questionForm.options=["",""]):this.questionForm.options=[],this.questionForm.answer="",this.multipleAnswers=[]}},created(){this.loadCategories()},methods:{goToUpload(){this.$router.push("/upload")},async loadCategories(){try{const e=await(0,d.rm)();this.categories=e.data.data}catch(e){u.nk.error("加载分类列表失败"),console.error(e)}},showAddCategoryDialog(){this.addCategoryDialogVisible=!0,this.categoryForm.name=""},handleCloseAddDialog(){this.addCategoryDialogVisible=!1,this.$refs.categoryFormRef?.resetFields()},async submitAddCategory(){try{const e=await this.$refs.categoryFormRef.validate();if(!e)return;this.addCategoryLoading=!0,await(0,d.Ah)(this.categoryForm),u.nk.success("分类添加成功"),this.handleCloseAddDialog(),await this.loadCategories();const o=this.categories.find(e=>e.name===this.categoryForm.name);o&&(this.questionForm.categoryId=o.id)}catch(e){u.nk.error("分类添加失败"),console.error(e)}finally{this.addCategoryLoading=!1}},addOption(){this.questionForm.options.push("")},removeOption(e){this.questionForm.options.length>2&&this.questionForm.options.splice(e,1)},async submitForm(){try{const e=await this.$refs.questionFormRef.validate();if(!e)return;this.loading=!0;const o={...this.questionForm,options:"CHOICE"===this.questionForm.type?this.questionForm.options.filter(e=>e.trim()):[]};await(0,d.CU)(o),u.nk.success("题目上传成功"),this.resetForm()}catch(e){u.nk.error("题目上传失败"),console.error(e)}finally{this.loading=!1}},resetForm(){this.$refs.questionFormRef.resetFields(),this.questionForm={content:"",categoryId:null,options:["",""],type:"",answer:""},this.multipleAnswers=[]},goBack(){this.$route.query.from?this.$router.push(this.$route.query.from):this.$router.go(-1)}}},g=t(1241);const p=(0,g.A)(c,[["render",n],["__scopeId","data-v-6654b8c8"]]);var F=p}}]);
//# sourceMappingURL=598.c93e6b68.js.map